# Translation Workflow Guide

This guide walks you through the complete translation workflow in NAB AL Tools, from initial setup to completed translations.

## Overview

NAB AL Tools provides a complete translation management system for Business Central AL applications using XLIFF (XML Localization Interchange File Format) files. The workflow is designed to streamline the translation process while maintaining quality and consistency.

## Prerequisites

- VS Code with AL Language extension
- Business Central AL project with translation support
- NAB AL Tools extension installed

## Understanding the Translation File Structure

Business Central uses XLIFF 1.2 format for translations:

- **g.xlf file** - Generated by the AL compiler, contains all translatable texts from your AL code
- **Language-specific XLF files** - One file per target language (e.g., `MyApp.da-DK.xlf`, `MyApp.sv-SE.xlf`)

Each translation unit (trans-unit) in an XLF file contains:

- `<source>` - The original text from your AL code
- `<target>` - The translated text
- `id` attribute - Unique identifier for the translation unit
- `state` attribute (optional) - Translation state when using target states

## Choosing Your Translation Mode

NAB AL Tools supports two translation modes:

### 1. NAB Tags Mode (Default)

**When to use:**

- Working without external translation tools
- Translating directly in VS Code
- Want clear visual markers for translation status
- Prefer simple text-based workflow

**How it works:**

- Uses searchable text tags like `[NAB: NOT TRANSLATED]`, `[NAB: REVIEW]`, `[NAB: SUGGESTION]`
- Tags are inserted directly in the `<target>` element
- Easy to find with standard search (Ctrl+F)
- Works well with basic text editors

**Enable:** `NAB.UseTargetStates`: `false` (default)

### 2. Target States Mode

**When to use:**

- Using external translation tools (Crowdin, MemoQ, SDL Trados, etc.)
- AI-assisted translation workflows with GitHub Copilot
- Working with professional translators who understand XLIFF
- Want XLIFF-standard state management

**How it works:**

- Uses XLIFF `state` attribute on `<target>` elements
- States include: `new`, `needs-translation`, `needs-adaptation`, `needs-review-translation`, `translated`, `signed-off`, `final`
- Recognized by professional translation tools
- Enables advanced translation workflows

**Enable:** `NAB.UseTargetStates`: `true`

**See also:** [Target States vs NAB Tags](../features/target-states-vs-nab-tags.md) for detailed comparison

## Basic Translation Workflow

### Step 1: Write Your AL Code

Create your AL code with labels, captions, and other translatable properties:

```al
page 50100 "Customer List"
{
    Caption = 'Customer List';

    field("Customer Name"; CustomerName)
    {
        Caption = 'Customer Name';
        ToolTip = 'Specifies the name of the customer.';
    }
}
```

### Step 2: Build Your Application

Compile your AL application to generate or update the g.xlf file:

1. Press `F5` or `Ctrl+Shift+B` to build
2. The AL compiler generates `YourApp.g.xlf` in the `Translations/` folder
3. This file contains all translatable texts from your code

### Step 3: Refresh XLF Files

Update your language-specific XLF files from the g.xlf file:

1. Open Command Palette (`Ctrl+Shift+P`)
2. Run **`NAB: Refresh XLF files from g.xlf`**

**What this does:**

- Adds new translation units from g.xlf
- Marks modified source texts for review
- Preserves existing translations
- Applies translation matching (if enabled)
- Sorts files to match g.xlf order

**Result:**

- New translations are marked for translation
- Modified translations are marked for review
- Existing valid translations remain unchanged

### Step 4: Translate Texts

Navigate through untranslated texts efficiently:

1. Open a language XLF file (e.g., `MyApp.da-DK.xlf`)
2. Press `Ctrl+Alt+U` or run **`NAB: Find next untranslated text`**
3. The cursor jumps to the next text needing attention
4. Translate or review the text:
   - **NAB Tags mode:** Replace `[NAB: NOT TRANSLATED]` with your translation
   - **Target States mode:** Update the target text, the state will be updated automatically
5. Repeat until all translations are complete

**Tips:**

- Use `Ctrl+Alt+U` repeatedly to work through all texts efficiently
- Keep the g.xlf file open in a side panel for reference
- Save frequently (`Ctrl+S`)

### Step 5: Verify Translations

Ensure all translations are complete:

1. Run **`NAB: Find untranslated texts`** to search for remaining items
2. Review the search results
3. Address any remaining translations

## Advanced Translation Features

### Translation Matching

Automatically reuse previous translations for identical source texts.

**Setting:** `NAB.MatchTranslation`: `true` (default)

**What it does:**

- Searches for identical source texts in your translation files
- Suggests previously used translations
- Reduces duplicate translation work

**Sources searched (in order):**

1. Current XLF file
2. Other language XLF files in workspace
3. Microsoft BaseApp translations (if downloaded)
4. Custom translation suggestion paths (if configured)

**How it works:**

**NAB Tags mode:**

- Found matches are prefixed with `[NAB: SUGGESTION]`
- Multiple matches create multiple `<target>` elements
- Review suggestions with `Ctrl+Alt+U`

**Target States mode:**

- First match is automatically applied
- Target state set to configured value (see `NAB.SetExactMatchToState`)
- State-qualifier set to `exact-match`

### Auto-Accept Suggestions

Automatically accept the first matched translation.

**Setting:** `NAB.AutoAcceptSuggestions`: `true`

**Requirements:**

- Only works when `NAB.UseTargetStates` is `false`
- Requires `NAB.MatchTranslation` enabled

**What it does:**

- Automatically uses the first matched translation without adding `[NAB: SUGGESTION]`
- Saves time when you trust your translation matching sources

### Using Glossaries

Glossaries ensure consistent terminology across translations.

#### Built-in Business Central Glossary

NAB AL Tools includes a built-in glossary with standard Business Central terms:

**How to use:**

- Glossary is available through Language Model Tools
- Use `getGlossaryTerms` tool in AI workflows
- Ensures consistent translation of BC terminology

#### Local Project Glossary

Create project-specific glossaries to enforce custom terminology:

**File location:** `Translations/glossary.tsv`

**Format:** Tab-separated values (TSV)

```tsv
en-US	da-DK	sv-SE	Description
Customer	Kunde	Kund	BC terminology
Item	Vare	Artikel	BC terminology
Custom Term	Brugerdefineret term	Anpassad term	Project-specific
```

**Structure:**

- First column: en-US (source language)
- Last column: Description (optional)
- Columns in between: language codes (da-DK, sv-SE, etc.)
- First line: ISO language codes as headers

**Creating a glossary:**

1. Use the `/manageGlossary` prompt in GitHub Copilot Chat
2. Or manually create `Translations/glossary.tsv` following the format above

**Benefits:**

- Local terms override built-in glossary
- Ensures consistent project-specific terminology
- Accessible to AI translation workflows
- Easy to maintain and version control

**See also:** [Glossary Management](../features/glossary.md)

### BaseApp Translation Matching

Leverage Microsoft's official Business Central translations:

**Command:** **`NAB: Match Translations From Base Application`**

**What it does:**

- Downloads official BaseApp translations for your target language
- Matches source texts with BaseApp translations
- Suggests BC-standard translations

**When to use:**

- Starting translation for a new language
- Working with standard BC objects and terminology
- Want to reuse Microsoft's professional translations

**Setting:** `NAB.MatchTranslation` must be enabled

**Workflow:**

1. Run **`NAB: Refresh XLF files from g.xlf`** (optional)
2. Run **`NAB: Match Translations From Base Application`**
3. Review suggestions with `Ctrl+Alt+U`
4. Accept or modify suggested translations

### Translation Comments in AL Code

Add temporary translations directly in your AL code:

**Setting:** `NAB.LanguageCodesInComments`

```al
field("Customer Name"; CustomerName)
{
    Caption = 'Customer Name'; // da-DK='Kundenavn', sv-SE='Kundnamn'
    ToolTip = 'Customer name'; // da-DK='Kundenavn', sv-SE='Kundnamn'
}
```

**When refresh is run:**

- Translations from comments are applied to XLF files
- Comments can optionally be removed after use

**Settings:**

- `NAB.LanguageCodesInComments` - Enable this feature
- `NAB.RemoveTranslationCommentsAfterUse` - Remove comments after applying

**Use case:** Quick translations during development without switching files

## Common Workflow Patterns

### Starting a New Language

1. Run **`NAB: Create translation XLF for new language`**
2. Select target language code (e.g., `da-DK`)
3. Choose whether to match BaseApp translations
4. File created as `YourApp.da-DK.xlf`
5. Follow basic workflow to complete translations

### Translating Between Non-English Languages

When translating from one non-English language to another:

1. Run **`NAB: Create XLF with selected Source Language`**
2. Select source language file (e.g., Danish)
3. Select target language file (e.g., Swedish)
4. Translate in the generated file
5. Run **`NAB: Import Translations by Id`** to import back

### Handling Modified Source Texts

When AL code changes, source texts may need review:

**NAB Tags mode:**

- Modified texts prefixed with `[NAB: REVIEW]`
- Original translation preserved for reference
- Update and remove tag when reviewed

**Target States mode:**

- State set to `needs-adaptation` or `needs-review-translation`
- Original translation preserved
- Setting `NAB.ClearTargetWhenSourceHasChanged` can clear target

**Review process:**

1. Use `Ctrl+Alt+U` to find review items
2. Check if translation still makes sense with new source
3. Update translation if needed
4. Remove tag or update state

### Working with External Translators

When sending files to external translators:

**Setup:**

1. Enable `NAB.UseTargetStates`: `true`
2. Configure `NAB.SetExactMatchToState` if using matching
3. Run **`NAB: Refresh XLF files from g.xlf`**

**Export:**

- Provide XLF files to translators
- They'll work with standard XLIFF tools
- States guide their workflow

**Import:**

- Receive translated XLF files
- Replace your XLF files
- Verify with **`NAB: Find untranslated texts`**

## Translation Quality Tips

### Best Practices

1. **Translate in context** - Keep the AL code open to understand usage
2. **Use consistent terminology** - Refer to glossaries
3. **Preserve placeholders** - Keep %1, %2, %3 in translations
4. **Respect character limits** - Some fields have max-length restrictions
5. **Test in BC** - Verify translations in the running application
6. **Version control** - Commit XLF files to source control

### Common Mistakes to Avoid

- ❌ Removing placeholders (%1, %2, etc.)
- ❌ Translating locked texts (translate="no")
- ❌ Exceeding maximum character lengths
- ❌ Inconsistent terminology across related texts
- ❌ Forgetting to save files after translation

### Handling Special Cases

**Placeholders:** Keep in same position or adjust for grammar

```
Source: "Post %1 entries"
Good: "Bogfør %1 poster" (Danish)
Bad: "Bogfør poster" (missing placeholder)
```

**HTML/XML Tags:** Preserve formatting tags

```
Source: "Click <b>OK</b> to continue"
Good: "Klik <b>OK</b> for at fortsætte"
```

**Variables:** Don't translate variable names in tooltip references

```
Source: "Specifies the value of the %1 field"
Translation: "[Translation of 'Specifies the value of the'] %1 [translation of 'field']"
```

## AI-Assisted Translation Workflow

NAB AL Tools provides powerful AI integration for automated translation:

### Using the NAB-XLF-Translator Agent

**Quick start:**

1. Open a file from your AL app
2. Run `/translateXlfFiles` in GitHub Copilot Chat
3. Agent handles the complete workflow automatically

**What the agent does:**

1. Identifies your AL application
2. Builds app to update g.xlf
3. Refreshes XLF files
4. Loads glossaries (built-in + local)
5. Translates texts in batches
6. Applies quality checks
7. Saves translations with appropriate states
8. Provides completion summary

**Benefits:**

- Fully automated translation process
- Consistent glossary usage
- Quality validation (placeholders, lengths)
- Handles large translation volumes
- Transparent progress tracking

**See also:** [Language Model Tools](../features/language-model-tools.md)

### Review Workflow

After AI translation, review and approve:

1. Run `/reviewXlfFiles` prompt
2. Agent retrieves texts needing review
3. Reviews for accuracy and quality
4. Updates states based on review
5. Provides review summary

**See also:** [Translation Review Workflow](translation-review-workflow.md)

## Settings Reference

Key settings for translation workflow:

### Core Settings

- `NAB.UseTargetStates` - Enable XLIFF state attributes instead of NAB tags
- `NAB.MatchTranslation` - Enable automatic translation matching
- `NAB.AutoAcceptSuggestions` - Auto-accept first match (NAB tags mode only)

### Advanced Settings

- `NAB.SetExactMatchToState` - State to set for exact matches (target states mode)
- `NAB.ClearTargetWhenSourceHasChanged` - Clear target when source changes
- `NAB.PreserveOriginalAttribute` - Match 'original' attribute between files
- `NAB.SkipTranslationPropertyForLanguage` - Skip specific properties per language
- `NAB.TranslationSuggestionPaths` - Custom paths for translation matching
- `NAB.SearchReplaceBeforeSaveXliff` - Regex search/replace before saving
- `NAB.RemoveTranslationCommentsAfterUse` - Remove AL code translation comments

**See also:** [Settings Reference](../reference/settings.md)

## Troubleshooting

### g.xlf file not found

**Problem:** Command fails with "Cannot find g.xlf file"

**Solution:**

1. Build your AL project (`F5` or `Ctrl+Shift+B`)
2. Verify `Translations/` folder exists
3. Check `app.json` has correct `name` field
4. Use **`NAB: Update g.xlf`** to generate without full build

### Translations not updating

**Problem:** Changes in AL code don't appear in g.xlf after build

**Solution:**

1. Clean your project: `Ctrl+Shift+P` → "AL: Clean"
2. Delete `objcache` folder
3. Rebuild application
4. Run **`NAB: Refresh XLF files from g.xlf`**

### Multiple targets appear

**Problem:** Translation units have multiple `<target>` elements

**Cause:** Translation matching found multiple different translations for same source

**Solution:**

1. Run **`NAB: Find multiple targets in XLF files`**
2. Review each case
3. Choose the correct translation
4. Remove extra `<target>` elements

**See also:** [Common Issues](../troubleshooting/common-issues.md)

## Next Steps

- Learn about [Translation Review Workflow](translation-review-workflow.md)
- Explore [XLIFF Tools](../features/xliff-tools.md)
- Understand [Target States vs NAB Tags](../features/target-states-vs-nab-tags.md)
- Set up [Local Glossaries](../features/glossary.md)
- Try [AI-Assisted Translation](../features/language-model-tools.md)
